<div class="container p-3">
    <div class="w-100 text-center my-3">
        <img src="/logo.png" alt="Insightic Logo" style="width: 60px; height: 60px;">
        <h2>Contract Diff</h2>
        <div class="w-100 mx-auto" style="max-width: 720px;">Contract Diff is a tool utilized for cross-validation and
            examination of whitepapers and smart contracts.
            By scrutinizing the whitepaper and smart contract, Contract Diff possesses the ability to uncover
            disparities between them and provide appropriate warnings.</div>
    </div>

    <div class="w-100 text-center mx-auto my-3 border rounded p-3" style="max-width: 640px;">
        <h3>Step 1</h3>
        <div class="w-100 my-2 mx-auto">Upload whitepaper</div>
        <div class="w-100 my-2 mx-auto" style="max-width: 320px;">
            <input class="form-control" type="file" id="fileInput1">
        </div>
    </div>

    <div class="w-100 text-center mx-auto my-3 border rounded p-3" style="max-width: 640px;">
        <h3>Step 2</h3>
        <div class="w-100 my-2 mx-auto">Upload Smart Contract code</div>
        <div class="w-100 my-2 mx-auto" style="max-width: 320px;">
            <input class="form-control" type="file" id="fileInput2">
        </div>
    </div>

    <div class="w-100 text-center my-3">
        <button class="btn btn-lg btn-danger" id="submit">Show Risks!</button>
    </div>
</div>

<script>
    const fileInput1 = document.getElementById('fileInput1');
    const fileInput2 = document.getElementById('fileInput2');
    const submit = document.getElementById('submit');
    let selectedFile1;
    let selectedFile2;

    fileInput1.addEventListener('change', (event) => {
        selectedFile1 = event.target.files[0];
    });

    fileInput2.addEventListener('change', (event) => {
        selectedFile2 = event.target.files[0];
    });

    submit.addEventListener("click", function () {
        if (!selectedFile1 || !selectedFile2) {
            alert("You have choose both WhitePaper and Code!");
            return;
        }
        let xhr = new XMLHttpRequest();
        xhr.open("POST", "https://staging-api.insightic.io/preSignedPut", true);
        let requestBody1 = {
            body1: selectedFile1,
        };
        xhr.onload = function () {
            if (xhr.status === 200) {
                let responseData = xhr.responseText;
                let responseObject = JSON.parse(responseData);
                let url = responseObject["payload"]["URL"];

                let xhr1 = new XMLHttpRequest();
                xhr1.open("PUT", url, true);

                xhr1.onload = function () {
                    if (xhr1.status === 200) {
                        let responseData1 = xhr1.responseText;
                        console.log("Second Response:", responseData1);
                    }
                };

                xhr1.send(requestBody1);
            }
        };
        xhr.send();

        let xhr2 = new XMLHttpRequest();
        xhr2.open("POST", "https://staging-api.insightic.io/preSignedPut", true);
        let requestBody2 = {
            body2: selectedFile2,
        };
        xhr2.onload = function () {
            if (xhr2.status === 200) {
                let responseData = xhr2.responseText;
                let responseObject = JSON.parse(responseData);
                let url = responseObject["payload"]["URL"];

                let xhr3 = new XMLHttpRequest();
                xhr3.open("PUT", url, true);

                xhr3.onload = function () {
                    if (xhr3.status === 200) {
                        let responseData2 = xhr3.responseText;
                        console.log("Second Response:", responseData2);
                    }
                };

                xhr3.send(requestBody2);
            }
        };
        xhr2.send();
        window.location.pathname = '/wait';
    });
</script>